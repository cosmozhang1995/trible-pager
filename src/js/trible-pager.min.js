
function TriblePager(list,startIndex,config){var thisRefer=this;this.container=null;this.view=null;this.pageContainer=null;this.closeButton=null;var loopInterval=null;var touchOn=false;var touchBegin={x:0.0,y:0.0,time:0,touchMoved:false};this.pageSize={width:0.0,height:0.0,marginLeft:0.0,marginTop:0.0};this.config={animateDuration:200,animateEasing:'swing',imgSrcKey:'url',defaultImgSrc:null,clickListener:null,clickDelay:300,longTouchListener:null,longTouchDelay:2000,sensitivity:0.5,pageSize:{width:'90%',height:'90%'},imageAdjustment:'proportion',loadingIndicator:null,closeButton:null,destroyCallback:null,createCallback:null,immediately:true,elementId:null};this.list=(list&&list.join)?list:[];this.currentIndex=startIndex?startIndex:0;$.extend(this.config,config);this.initPageSize=function(){if(this.container){var windowWidth=$(window).width();var windowHeight=$(window).height();$(this.container).css('width',windowWidth+'px');$(this.container).css('height',windowHeight+'px');this.pageSize.width=windowWidth*0.9;this.pageSize.height=windowHeight*0.9;if(this.config.pageSize.width.indexOf('%')>0){var percentage=parseFloat(this.config.pageSize.width.replace(/[^\d]/g,''));this.pageSize.width=windowWidth*(percentage/100.0);}else if(this.config.pageSize.width.indexOf('px')){var pixels=parseFloat(this.config.pageSize.width.replace(/[^\d]/g,''));this.pageSize.width=pixels;}else if(typeof this.config.pageSize.width==="number"){this.pageSize.width=parseFloat(this.config.pageSize.width);}
if(this.config.pageSize.height.indexOf('%')>0){var percentage=parseFloat(this.config.pageSize.height.replace(/[^\d]/g,''));this.pageSize.height=windowHeight*(percentage/100.0);}else if(this.config.pageSize.height.indexOf('px')){var pixels=parseFloat(this.config.pageSize.height.replace(/[^\d]/g,''));this.pageSize.height=pixels;}else if(typeof this.config.pageSize.height==="number"){this.pageSize.height=parseFloat(this.config.pageSize.height);}
this.pageSize.marginLeft=(parseFloat(windowWidth)-parseFloat(this.pageSize.width))*0.5;this.pageSize.marginTop=(parseFloat(windowHeight)-parseFloat(this.pageSize.height))*0.5;$(this.view).css('margin-left',this.pageSize.marginLeft+'px');$(this.view).css('margin-right',this.pageSize.marginLeft+'px');$(this.view).css('margin-top',this.pageSize.marginTop+'px');$(this.view).css('margin-bottom',this.pageSize.marginTop+'px');$(this.container).find('.pager-page').css('width',this.pageSize.width+'px');$(this.container).find('.pager-page').css('height',this.pageSize.height+'px');$(this.container).find('.pager-page .loading-indicator').css('line-height',this.pageSize.height+'px');$(this.view).css('width',this.pageSize.width+'px');$(this.view).css('height',this.pageSize.height+'px');$(this.pageContainer).css('margin-left',(0-this.pageSize.width)+'px');$(this.pageContainer).find('.pager-page img').each(function(){if(typeof this.pagerResize==="function")this.pagerResize();});}};var onPageTouchStart=function(event){if((!event.clientX)||(!event.clientY)){event.clientX=event.changedTouches[0].clientX;event.clientY=event.changedTouches[0].clientY;}
event.preventDefault();touchOn=true;touchBegin.time=(new Date()).getTime();touchBegin.touchMoved=false;if(typeof thisRefer.config.longTouchListener){setTimeout(function(){if((!touchBegin.touchMoved)&&(typeof thisRefer.config.longTouchListener==="function"))
thisRefer.config.longTouchListener(event,thisRefer);},thisRefer.config.longTouchDelay);}
touchBegin.x=event.clientX+(document.body.scrollLeft||document.documentElement.scrollLeft);touchBegin.y=event.clientY+(document.body.scrollTop||document.documentElement.scrollTop);stopBubble(event);};var onPageTouchMove=function(event){if((!event.clientX)||(!event.clientY)){event.clientX=event.changedTouches[0].clientX;event.clientY=event.changedTouches[0].clientY;}
event.preventDefault();if(touchOn){touchBegin.touchMoved=true;var clientX=event.clientX+(document.body.scrollLeft||document.documentElement.scrollLeft);var clientY=event.clientY+(document.body.scrollTop||document.documentElement.scrollTop);var offsetX=clientX-touchBegin.x;var offsetY=clientY-touchBegin.y;$(thisRefer.pageContainer).css('marginLeft',(offsetX-thisRefer.pageSize.width)+'px');}
stopBubble(event);};var onPageTouchEnd=function(event){if((!event.clientX)||(!event.clientY)){event.clientX=event.changedTouches[0].clientX;event.clientY=event.changedTouches[0].clientY;}
event.preventDefault();if(touchOn){var currTime=(new Date()).getTime();if(currTime-touchBegin.time<thisRefer.config.clickDelay){if((!touchBegin.touchMoved)&&(typeof thisRefer.config.clickListener==="function"))
thisRefer.config.clickListener(event,thisRefer);}
var clientX=event.clientX+(document.body.scrollLeft||document.documentElement.scrollLeft);var clientY=event.clientY+(document.body.scrollTop||document.documentElement.scrollTop);var offsetX=clientX-touchBegin.x;var offsetY=clientY-touchBegin.y;if(offsetX>0){if(offsetX>(parseFloat(thisRefer.pageSize.width)*thisRefer.config.sensitivity)){thisRefer.gotoPrev();}else{thisRefer.gotoCurrent();}}else{if((0-offsetX)>(parseFloat(thisRefer.pageSize.width)*thisRefer.config.sensitivity)){thisRefer.gotoNext();}else{thisRefer.gotoCurrent();}}}
touchOn=false;stopBubble(event);};this.gotoNext=function(){var thePagerView=this;if(thePagerView.currentIndex+1<thePagerView.list.length){$(thePagerView.pageContainer).animate({"marginLeft":(0-thePagerView.pageSize.width*2)+"px"},thePagerView.config.animateDuration,thePagerView.config.animateEasing,function(){thePagerView.currentIndex+=1;var pendingUrl=(thePagerView.currentIndex+1<thePagerView.list.length)?thePagerView.list[thePagerView.currentIndex+1][thePagerView.config.imgSrcKey]:null;thePagerView.pushPage(pendingUrl);thePagerView.shiftPage();thePagerView.pageContainer.style.marginLeft=(0-thePagerView.pageSize.width)+'px';});}else{$(thePagerView.pageContainer).animate({"marginLeft":(0-thePagerView.pageSize.width)+"px"},thePagerView.config.animateDuration,thePagerView.config.animateEasing);}};this.gotoPrev=function(){var thePagerView=this;if(thePagerView.currentIndex-1>=0){$(thePagerView.pageContainer).animate({"marginLeft":"0px"},thePagerView.config.animateDuration,thePagerView.config.animateEasing,function(){thePagerView.currentIndex-=1;var pendingUrl=(thePagerView.currentIndex-1>=0)?thePagerView.list[thePagerView.currentIndex-1][thePagerView.config.imgSrcKey]:null;thePagerView.insertPage(pendingUrl);thePagerView.popPage();thePagerView.pageContainer.style.marginLeft=(0-thePagerView.pageSize.width)+'px';});}else{$(thePagerView.pageContainer).animate({"marginLeft":(0-thePagerView.pageSize.width)+"px"},thePagerView.config.animateDuration,thePagerView.config.animateEasing);}};this.gotoCurrent=function(){var thePagerView=this;$(thePagerView.pageContainer).animate({"marginLeft":(0-thePagerView.pageSize.width)+"px"},thePagerView.config.animateDuration,thePagerView.config.animateEasing);}
this.createPager=function(){this.container=document.createElement('div');this.container.className="pager-container";this.view=document.createElement('div');this.view.className="pager";this.pageContainer=document.createElement('div');this.pageContainer.className="pager-page-container";if(this.config.elementId)this.container.id=this.config.elementId;if(this.config.closeButton){this.closeButton=document.createElement('div');this.closeButton.className="pager-close-button";this.closeButton.innerHTML=this.config.closeButton;this.closeButton.onclick=function(){thisRefer.destroy();}}
this.container.appendChild(this.view);if(this.config.closeButton)this.container.appendChild(this.closeButton);this.view.appendChild(this.pageContainer);document.body.appendChild(this.container);this.view.ontouchstart=onPageTouchStart;this.view.ontouchmove=onPageTouchMove;this.view.ontouchend=onPageTouchEnd;this.view.onmousedown=onPageTouchStart;this.view.onmousemove=onPageTouchMove;this.view.onmouseup=onPageTouchEnd;var initialImageUrl1=(this.currentIndex-1>=0)?this.list[this.currentIndex-1][this.config.imgSrcKey]:null;var initialImageUrl2=(this.currentIndex>=0&&this.currentIndex<this.list.length)?this.list[this.currentIndex][this.config.imgSrcKey]:null;var initialImageUrl3=(this.currentIndex+1<this.list.length)?this.list[this.currentIndex+1][this.config.imgSrcKey]:null;this.initializePager(initialImageUrl1,initialImageUrl2,initialImageUrl3);this.initPageSize();};this.initializePager=function(src1,src2,src3){this.pageContainer.removeAllChildNodes();this.pushPage(src1);this.pushPage(src2);this.pushPage(src3);};var imgResize=function(){$(this).css('height','auto');$(this).css('width','auto');var thePage=$(this).parents('.pager-page')[0];var pageWidth=parseFloat($(thePage).width());var pageHeight=parseFloat($(thePage).height());var thisWidth=parseFloat($(this).width());var thisHeight=parseFloat($(this).height());if(thisWidth>0&&thisHeight>0){if(thisRefer.config.imageAdjustment==="fill"){$(this).css('width',pageWidth+'px');$(this).css('height',pageHeight+'px');$(this).css('marginLeft','0px');$(this).css('marginTop','0px');}else{var adjustmentOptions=thisRefer.config.imageAdjustment.split('|');var proportion=false;var cut=false;var auto=false;for(var i=0;i<adjustmentOptions.length;i++){if(adjustmentOptions[i]==="proportion"){proportion=true;}else if(adjustmentOptions[i]==="cut"){cut=true;}else if(adjustmentOptions[i]==="auto"){auto=true;}}
if(!(proportion||cut||auto))proportion=true;if(proportion){if(thisWidth/thisHeight>pageWidth/pageHeight){if(thisWidth>pageWidth||(!auto)){var resizeRate=thisWidth/pageWidth;var resizeWidth=thisWidth/resizeRate;var resizeHeight=thisHeight/resizeRate;$(this).css('width',resizeWidth+'px');$(this).css('height',resizeHeight+'px');$(this).css('marginLeft',((pageWidth-resizeWidth)/2)+'px');$(this).css('marginTop',((pageHeight-resizeHeight)/2)+'px');}else{var resizeWidth=thisWidth;var resizeHeight=thisHeight;$(this).css('width',resizeWidth+'px');$(this).css('height',resizeHeight+'px');$(this).css('marginLeft',((pageWidth-resizeWidth)/2)+'px');$(this).css('marginTop',((pageHeight-resizeHeight)/2)+'px');}}else{if(thisHeight>pageHeight||(!auto)){var resizeRate=thisHeight/pageHeight;var resizeWidth=thisWidth/resizeRate;var resizeHeight=thisHeight/resizeRate;$(this).css('width',resizeWidth+'px');$(this).css('height',resizeHeight+'px');$(this).css('marginLeft',((pageWidth-resizeWidth)/2)+'px');$(this).css('marginTop',((pageHeight-resizeHeight)/2)+'px');}else{var resizeWidth=thisWidth;var resizeHeight=thisHeight;$(this).css('width',resizeWidth+'px');$(this).css('height',resizeHeight+'px');$(this).css('marginLeft',((pageWidth-resizeWidth)/2)+'px');$(this).css('marginTop',((pageHeight-resizeHeight)/2)+'px');}}}else if(cut){if(thisWidth/thisHeight>pageWidth/pageHeight){if(thisHeight>pageHeight||(!auto)){var resizeRate=thisHeight/pageHeight;var resizeWidth=thisWidth/resizeRate;var resizeHeight=thisHeight/resizeRate;$(this).css('width',resizeWidth+'px');$(this).css('height',resizeHeight+'px');$(this).css('marginLeft',((pageWidth-resizeWidth)/2)+'px');$(this).css('marginTop',((pageHeight-resizeHeight)/2)+'px');}else{var resizeWidth=thisWidth;var resizeHeight=thisHeight;$(this).css('width',resizeWidth+'px');$(this).css('height',resizeHeight+'px');$(this).css('marginLeft',((pageWidth-resizeWidth)/2)+'px');$(this).css('marginTop',((pageHeight-resizeHeight)/2)+'px');}}else{if(thisWidth>pageWidth||(!auto)){var resizeRate=thisWidth/pageWidth;var resizeWidth=thisWidth/resizeRate;var resizeHeight=thisHeight/resizeRate;$(this).css('width',resizeWidth+'px');$(this).css('height',resizeHeight+'px');$(this).css('marginLeft',((pageWidth-resizeWidth)/2)+'px');$(this).css('marginTop',((pageHeight-resizeHeight)/2)+'px');}else{var resizeWidth=thisWidth;var resizeHeight=thisHeight;$(this).css('width',resizeWidth+'px');$(this).css('height',resizeHeight+'px');$(this).css('marginLeft',((pageWidth-resizeWidth)/2)+'px');$(this).css('marginTop',((pageHeight-resizeHeight)/2)+'px');}}}}}};this.pushPage=function(src){var page=document.createElement('div');page.className="pager-page";var loadingIndicator=document.createElement('div');loadingIndicator.className="pager-loading-indicator";var loadingIndicatorContent=document.createElement('div');loadingIndicatorContent.className="pager-loading-indicator-content";var img=document.createElement('img');page.style.width=this.pageSize.width+'px';page.style.height=this.pageSize.height+'px';loadingIndicator.style.lineHeight=this.pageSize.height+'px';img.style.width="auto";img.style.height="auto";if(this.config.loadingIndicator&&src)loadingIndicatorContent.innerHTML=this.config.loadingIndicator;if(src)page.appendChild(img);loadingIndicator.appendChild(loadingIndicatorContent);page.appendChild(loadingIndicator);this.pageContainer.appendChild(page);if(src){img.pagerResize=imgResize;img.onerror=function(){if(thisRefer.config.defaultImgSrc)this.src=thisRefer.config.defaultImgSrc;else this.removeAttribute('src');};img.onload=function(){$(loadingIndicator).hide();};img.src=src;}};this.insertPage=function(src){var page=document.createElement('div');page.className="pager-page";var loadingIndicator=document.createElement('div');loadingIndicator.className="pager-loading-indicator";var loadingIndicatorContent=document.createElement('div');loadingIndicatorContent.className="pager-loading-indicator-content";var img=document.createElement('img');page.style.width=this.pageSize.width+'px';page.style.height=this.pageSize.height+'px';loadingIndicator.style.lineHeight=this.pageSize.height+'px';img.style.width="auto";img.style.height="auto";if(this.config.loadingIndicator&&src)loadingIndicatorContent.innerHTML=this.config.loadingIndicator;if(src)page.appendChild(img);loadingIndicator.appendChild(loadingIndicatorContent);page.appendChild(loadingIndicator);this.pageContainer.insertBefore(page,this.pageContainer.childNodes[0]);if(src){img.pagerResize=imgResize;img.onerror=function(){if(thisRefer.config.defaultImgSrc)this.src=thisRefer.config.defaultImgSrc;else this.removeAttribute('src');};img.onload=function(){$(loadingIndicator).hide();};img.src=src;}};this.shiftPage=function(){$($(this.pageContainer).find('.pager-page')[0]).remove();};this.popPage=function(){var thePages=$(this.pageContainer).find('.pager-page');if(thePages.length>0)$(thePages[thePages.length-1]).remove();};this.destroy=function(){$(this.container).remove();window.clearInterval(loopInterval);if(typeof this.config.destroyCallback==="function")this.config.destroyCallback(this);};this.create=function(){this.createPager();$(window).resize(function(){thisRefer.initPageSize();});loopInterval=window.setInterval(function(){$(thisRefer.pageContainer).find('.pager-page img').each(function(){var currWidth=$(this).width();var currHeight=$(this).height();var lastWidth=$(this).data('pagerLastWidth');var lastHeight=$(this).data('pagerLastHeight');if(!((currWidth===lastWidth)&&(currHeight===lastHeight))){$(this).data('pagerLastWidth',currWidth);$(this).data('pagerLastHeight',currHeight);if(typeof this.pagerResize==="function"){this.pagerResize();}}});},200);if(typeof this.config.createCallback==="function")this.config.createCallback(this);};if(this.config.immediately)this.create();}